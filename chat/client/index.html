<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Socket.IO Chat Example</title>
    <link rel="stylesheet" href="style.css">
    <script src="node_modules/socket.io-client/dist/socket.io.js"></script>
    <script type="module" src="ChatApp.js"></script>
</head>
<body>
<chat-app></chat-app>
<script>
    // Once the service worker is registered set the initial state
    function initialiseState() {
        // Are Notifications supported in the service worker?
        if (!('showNotification' in ServiceWorkerRegistration.prototype)) {
            console.warn('Notifications aren\'t supported.');
            return;
        }

        // Check the current Notification permission.
        // If its denied, it's a permanent block until the
        // user changes the permission
        if (Notification.permission === 'denied') {
            console.warn('The user has blocked notifications.');
            return;
        }

        // Check if push messaging is supported
        if (!('PushManager' in window)) {
            console.warn('Push messaging isn\'t supported.');
            return;
        }

        // We need the service worker registration to check for a subscription
        navigator.serviceWorker.ready.then(serviceWorkerRegistration => {
            // Do we already have a push message subscription?
            serviceWorkerRegistration.pushManager.getSubscription()
                .then(subscription => {

                    if (!subscription) {
                        Notification.requestPermission().then(() => {
                            console.log('Permission granted! for push notification');
                        }).catch(() => {
                            console.log('Permission denied! for push notification');
                        });
                    }

                    // Keep your server in sync with the latest subscriptionId
                    // sendSubscriptionToServer(subscription);
                })
                .catch(error => {
                    console.warn('Error during getSubscription()', error);
                });
        });
    }

    <!-- SW -->
</script>
</body>
</html>
